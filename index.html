<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game TIC TAC TOE</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>GAME</h1>
        <p>Test page game</p>
    </header>
    <div class="res"></div>
    <div class="game">
        <div class="field"></div>
        <div class="field"></div>
        <div class="field"></div>
        <div class="field"></div>
        <div class="field"></div>
        <div class="field"></div>
        <div class="field"></div>
        <div class="field"></div>
        <div class="field"></div>
    </div>
    <button class="new-game">Новая игра</button>
    <footer>
        <h2>footer site</h2>
    </footer>
    <script>
        //let c = document.querySelector('circle'); Вычисляем длину круга
//alert(c.getTotalLength()); Вычисляем длину круга
let game = document.querySelector('.game'),
    res = document.querySelector('.res'),
    btnGame = document.querySelector('.new-game'),
    fields = document.querySelectorAll('.field'),
    count = 0,
    step = false,
    //SVG разметку пишем сначало в блоке с классом field
    circle = '<svg class="circle"><circle r="45" cx="58" cy="58" stroke="blue" stroke-width="10" fill="none" stroke-linecap="round"/></svg>',
    cross = '<svg class="cross"><line class="first" x1="15" y1="15" x2="100" y2="100" stroke="red" stroke-width="10" stroke-linecap="round"/><line class="second" x1="100" y1="15" x2="15" y2="100" stroke="red" stroke-width="10" stroke-linecap="round"/></svg>'; 
    // Функция function stepCross() инициалзации отрисовки крестика
    function stepCross(target){
        target.innerHTML = cross;
        target.classList.add('x');
        let crossAudio = new Audio('audio/cross.mp3');
        crossAudio.play(); // инициализация аудиозвука для крестика
        count++;
    }
    // Функция function stepCircle() инициалзации отрисовки нолика
    function stepCircle(target){
        target.innerHTML = circle;
        target.classList.add('o');
        let circleAudio = new Audio('audio/circle.mp3');
        circleAudio.play(); // инициализация аудиозвука для нолика
        count++;
    }
    // Инициализация игры
    function init(e){
        if(!step) stepCross(e.target);
        else stepCircle(e.target);
        step = !step;
        win();
    }
    //Очищаем игровое поле для новой игры в функции newGame() сработает при нажатии кнопочки
    function newGame(){
        step = false;
        count = 0;
        res.innerText = '';
        fields.forEach(item =>{
            item.innerHTML = '';
            item.classList.remove('x','o', 'active');
        });
        //После очистки игрового поля иниц. по нажатию кнопки новую игру
        game.addEventListener('click', init);
    }
    // Функция win главная в коде игры . В ней вся логика
    function win(){
        let comb = [
            [0, 1, 2],//**************************************
            [3, 4, 5],//ARRAY ELEMENT HORIZONT LINE
            [6, 7, 8],//***************************************
            [0, 3, 6],//**************************************
            [1, 4, 7],//ARRAY ELEMENT VERTICAL LINE
            [2, 5, 8],//***************************************
            [0, 4, 8],//ARRAY ELEMENT DIAGONAL TOP LEFT 
            [2, 4, 6]//ARRAY ELEMENT DIAGONAL TOP RIGTH LINE
        ];
        for(let i = 0; i < comb.length; i++){
            if(fields[comb[i][0]].classList.contains('x') &&
            fields[comb[i][1]].classList.contains('x') &&
            fields[comb[i][2]].classList.contains('x')) {
                setTimeout(() => {
                    fields[comb[i][0]].classList.add('active');
                    fields[comb[i][1]].classList.add('active');
                    fields[comb[i][2]].classList.add('active');
                    res.innerText = 'Выйграл Х';
                },1500);
                game.removeEventListener('click', init);
            }
       else if(fields[comb[i][0]].classList.contains('o') &&
       fields[comb[i][1]].classList.contains('o') &&
       fields[comb[i][2]].classList.contains('o')) {
           setTimeout(() => {
               fields[comb[i][0]].classList.add('active');
               fields[comb[i][1]].classList.add('active');
               fields[comb[i][2]].classList.add('active');
               res.innerText = 'Выйграл O';
           },1500);
           game.removeEventListener('click', init);
       }
        else if(count == 9){
            res.innerText = 'Ничья';
            game.removeEventListener('click', init);
        }
    }
}
    btnGame.addEventListener("click", newGame);
    game.addEventListener('click', init);
    </script>
</body>
</html>